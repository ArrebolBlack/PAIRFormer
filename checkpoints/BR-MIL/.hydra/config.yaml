data:
  name: mirna_miraw
  path:
    train: data/miRAW_Test1-5_split-ratio-0.9_Train_Validation.txt
    val: data/miRAW_Test1-5_split-ratio-0.9_Train_Validation.txt
    test: data/miRAW_Test_0,6-9.txt
  with_esa: true
  alignment: extended_seed_alignment
  split_column: 5
  split_map:
    train: train
    val: val
model:
  name: pair_set_transformer_v0
  arch: PairSetTransformerAggregator
  num_channels:
  - 16
  - 16
  - 32
  num_blocks:
  - 2
  - 1
  - 1
  pool_size: 3
  stem_kernel_size: 5
  block_kernel_size: 3
  skip_connection: true
  dropout: 0.1
  in_dim: 387
  d_model: 256
  n_heads: 8
  dim_ff: 512
  ff_activation: gelu
  n_layers: 3
  block_type: isab
  num_inducing_points: 16
  num_seeds: 1
  use_output_sab: false
train:
  optimizer: adamw
  betas:
  - 0.9
  - 0.999
  eps: 1.0e-08
  adam_weight_decay: 0.01
  amsgrad: false
  lr: 0.001
  weight_decay: 0.01
  momentum: 0.9
  scheduler: none
  scheduler_factor: 0.2
  scheduler_patience: 5
  scheduler_t_max: 10
  scheduler_step_size: 10
  scheduler_gamma: 0.1
  pos_weight: 1.0
  label_smoothing: false
  smooth_pos: 1.0
  smooth_neg: 0.0
  loss_type: bce
  focal_gamma: 1.0
  focal_alpha: 0.4
  focal_lambda: 1
  bce_lambda: 0.01
  esa_weighting: false
  esa_scale: 10.0
  esa_lambda_pos: 0.5
  esa_lambda_neg: 0.0
  amp: true
  grad_clip: 1.0
  ema:
    enabled: false
    decay: 0.999
  monitor: f1
  greater_is_better: true
task:
  problem_type: binary_classification
  from_logits: true
  threshold: 0.5
  ranking:
    enabled: true
    ks:
    - 1
    - 10
    - 32
    - 64
    - 128
    compute_topk_overlap: true
    bucket:
      strategy: quantile
      num_buckets: 5
run:
  mode: train
  num_epochs: 100
  batch_size: 64
  num_workers: 16
  pin_memory: true
  cache_path: ${paths.cache_root}
  resume: false
  checkpoint: null
  reduction: max
  train_reduction: none
  eval_reduction: none
  test_reduction: none
  train_softmax_temp: 1.0
  eval_softmax_temp: 1.0
  test_softmax_temp: 1.0
  train_topk: 3
  eval_topk: 3
  test_topk: 3
  ckpt_subdir: checkpoints
  eval_subdir: eval
  ckpt_dir: ${hydra:run.dir}/${run.ckpt_subdir}
  eval_dir: ${hydra:run.dir}/${run.eval_subdir}
  eval_test_after_train: true
  test_splits:
  - test
  split: train
  val_split: val
  kmax: 64
  include_pos: true
  include_esa: true
  eval_test_with_last: true
  eval_test_with_best: true
  best_ckpt_path: null
  train_instance_mode: online
  val_instance_mode: online
  force_overwrite_bootstrap: true
  refresh_instance_after_update: true
eval:
  save_dir: eval_outputs
  do_threshold_sweep: true
  sweep_num_thresholds: 101
  use_val_best_threshold: false
  best_threshold_path: null
  save_metrics_json: true
  save_report_txt: true
  save_threshold_csv: true
  save_curves_png: true
  roc_curve_file: roc_curve.png
  pr_curve_file: pr_curve.png
logging:
  wandb:
    enabled: true
    project: miRAW_EM_Pipeline
    entity: null
    mode: online
    group: SetTransformer_Find_SOTA_2
    tags:
    - EM
    - PairAgg
    - SetTransformer
    - HybridPolicy
  eval:
    use_wandb: false
    wandb_prefix: eval
paths:
  output_root: outputs
  cache_root: cache
  logs_root: logs
experiment_name: SOTA2
experiment:
  name: miRAW_EM_Pipeline
  task: em_pair_level_train
seed: 2020
device: cuda
em:
  controller:
    refresh_on_rank0_only: true
    barrier_after_refresh: true
    rebuild_train_loader_after_selection_refresh: true
    verbose: true
  inst_emb_dim: 384
  inst_version: inst_v0
  cheap_emb_dim: 64
  cheap_version: cheap_v0
  cheap_cache:
    batch_size: 10240
    num_workers: 16
    amp: true
    has_entropy: false
  instance_cache:
    batch_size: 10240
    num_workers: 16
    use_amp: true
    normalize_emb: false
  bootstrap:
    enabled: true
  selector_module:
    _target_: src.selectors.selector_module.SelectorModule
    cfg:
      _target_: src.selectors.st_selector.STSelectorConfig
      kmax: ${run.kmax}
      k1_ratio: 0.5
      score_use_sigmoid: false
      exploration_sigma: 0.0
      base_seed: ${seed}
      pos_bin_eps: 1.0e-06
      use_hash_dedup: true
      hash_seed: ${seed}
      score_norm_z: true
      score_norm_eps: 1.0e-06
      quota_top_t: 8
      quota_tau_w: 1.0
  sel_version: null
  selection_cache:
    pair_batch_size: 10240
  policy:
    warmup_epochs: 55
    instance_mode: hybrid
    instance_update_every_epochs: 1
    instance_update_steps: 0
    cheap_mode: cached
    cheap_update_every_steps: 0
    cheap_update_every_epochs: 0
    cheap_update_steps: 0
    refresh_cheap_cache_every_epochs: 0
    refresh_selection_cache_every_epochs: 0
    refresh_instance_cache_every_epochs: 0
    refresh_selection_follows_cheap: true
    refresh_instance_follows_selection: true
em_cache_root: ${paths.cache_root}
cheap_ckpt_path: checkpoints/CheapCTSNet/checkpoints/last.pt
instance_ckpt_path: checkpoints/miRAW_TargetNet_Optimized_dp-0.1/checkpoints/last.pt
token_provider:
  cache_missing: error
  use_amp: false
  normalize_tokens: false
  assemble:
    use_inst_emb: true
    use_inst_logit: true
    use_esa: true
    use_pos: true
cheap_model:
  name: CheapCTSNet
  arch: CheapCTSNet_TinyConv
  meta_mode: logit_only
  meta_dropout: 0.2
  emb_dim: 64
  use_diff: true
  dropout: 0.0
  logit_hidden_dim: 64
  c1: 16
  c2: 32
  k1: 5
  k2: 3
  s1: 2
  s2: 2
instance_model:
  name: targetnet_optimized
  arch: TargetNet_Optimized
  num_channels:
  - 16
  - 16
  - 32
  - 32
  num_blocks:
  - 1
  - 1
  - 1
  - 1
  pool_size: 3
  stem_kernel_size: 5
  block_kernel_size: 3
  skip_connection: true
  dropout: 0.5
  multi_scale: false
  se_type: basic
  use_bn: false
  se_reduction: 8
  target_output_length: 12
  arch_variant: opt4_tiny
trainer_em:
  num_epochs: ${run.num_epochs}
  log_every: 50
  grad_accum_steps: 1
  clip_grad_norm: 0.0
  use_amp: false
  loss_type: focal
  esa_weighting: true
  focal_alpha: 0.4
  focal_gamma: 1.0
  focal_lambda: 1.0
  label_smoothing: true
  smooth_neg: 0.05
  smooth_pos: 0.95
  bce_lambda: 0.01
  pos_weight: 1.0
  bce_pos_weight: 1.0
  esa_scale: 10.0
  esa_lambda_pos: 1.0
  esa_lambda_neg: 0.5
  optimizer: adamw
  betas:
  - 0.9
  - 0.999
  eps: 1.0e-08
  amsgrad: false
  lr_agg: 0.0003
  wd_agg: 0.01
  lr_inst: 0.0003
  wd_inst: 0.0
  scheduler_agg: cosine
  scheduler_inst: cosine
  scheduler_t_max: ${run.num_epochs}
  scheduler_step_size: 10
  scheduler_gamma: 0.1
  scheduler_factor: 0.2
  scheduler_patience: 5
  monitor: loss
  greater_is_better: false
  ema_enabled: true
  ema_decay: 0.999
